---
phase: 05-verification
plan: 03
type: execute
wave: 2
depends_on: [05-02]
files_modified: [README.md, CONTRIBUTING.md]
autonomous: true
user_setup: []

must_haves:
  truths:
    - "README.md has Compatibility section with tested Pike versions"
    - "README.md documents Known Issues table for version-specific problems"
    - "CONTRIBUTING.md explains local dev setup (8.1116) vs CI (version matrix)"
    - "Version detection is logged at startup via LSP.Compat.pike_version()"
  artifacts:
    - path: "README.md"
      provides: "Compatibility documentation"
      contains: "Compatibility"
      contains: "Known Issues"
    - path: "CONTRIBUTING.md"
      provides: "Contributor setup documentation"
      contains: "Pike version"
  key_links:
    - from: "README.md"
      to: "LSP.Compat.pike_version()"
      via: "Documentation of version logging"
      pattern: "pike_version|Compatibility"
---

<objective>
Add compatibility documentation to README.md and update CONTRIBUTING.md to explain the two-tier version support model.

Purpose: Clear documentation for users and contributors about which Pike versions are tested and supported. This manages expectations and provides guidance for reporting version-specific issues.
Output: Updated README.md with Compatibility section and updated CONTRIBUTING.md with version guidance.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-verification/05-CONTEXT.md
@.planning/REQUIREMENTS.md

# Existing documentation
@README.md
@CONTRIBUTING.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Compatibility section to README.md</name>
  <files>README.md</files>
  <action>
Add a "Compatibility" section to README.md after the "Requirements" section and before "Installation". The section should include:

1. **Section heading:** `## Compatibility`

2. **Supported Pike versions table:**
   ```
   | Version | Status | Notes |
   |---------|--------|-------|
   | Pike 8.1116 | ✅ Required | Primary target, must pass CI |
   | Pike 8.x latest | ⚠️ Best-effort | Forward compatibility check |
   | Pike 7.x | ❌ Not supported | Use Pike 8.1116 or later |
   ```

3. **Testing matrix explanation:**
   - CI tests on multiple Pike versions using matrix strategy
   - Required version must pass to merge
   - Latest version failures don't block merge but are documented

4. **Known Issues table** (empty for now, ready for future issues):
   ```
   ### Known Issues

   | Issue | Affected Versions | Workaround | Status |
   |-------|------------------|------------|--------|
   | None currently | - | - | - |
   ```

5. **Version detection note:**
   - The analyzer logs its detected Pike version at startup
   - This helps with debugging version-specific issues

6. **Local development note:**
   - Contributors can develop on Pike 8.1116
   - CI handles the full version matrix

Insert this section after "## Requirements" (around line 50) and before "## Installation".
  </action>
  <verify>grep -A 30 "## Compatibility" /home/smuks/OpenCode/pike-lsp/README.md | head -35</verify>
  <done>README.md has Compatibility section with supported versions table, Known Issues table, and version detection documentation.</done>
</task>

<task type="auto">
  <name>Task 2: Update CONTRIBUTING.md with version guidance</name>
  <files>CONTRIBUTING.md</files>
  <action>
Update CONTRIBUTING.md to clarify Pike version requirements for contributors:

1. **In "Prerequisites" section** (around line 15):
   - Change "Pike 8.0+" to "Pike 8.1116 or later"
   - Add note: "For local development, Pike 8.1116 is recommended. CI tests on multiple versions."

2. **In "Testing Guidelines" section** (around line 116):
   - Add subsection about Pike version testing:
     ```
     ### Version Testing

     - Local development: Use Pike 8.1116
     - CI: Tests on Pike 8.1116 (required) and latest (best-effort)
     - When adding compat shims: Test on both versions if possible
     - Version-specific issues: Add to Known Issues table in README
     ```

3. **In "Code Style > Pike" section** (around line 184):
   - Add note: "Use LSP.Compat.pike_version() for version detection instead of checking __REAL_VERSION__ directly."
   - Add note: "For version-specific code, use Compat.pmod polyfills or #if constant() checks."

4. **In "Reporting Issues > Bug Reports" section** (around line 229):
   - Add "Pike version" to the required information (it's already there, but emphasize it)
   - Add: "Include output from `pike --version` and any version-specific error messages"

These updates help contributors understand the version support model without needing to read CI configuration.
  </action>
  <verify>grep -E "(Pike 8.1116|LSP.Compat|Version Testing)" /home/smuks/OpenCode/pike-lsp/CONTRIBUTING.md</verify>
  <done>CONTRIBUTING.md explains local dev on 8.1116, CI version matrix, and when to use compat shims.</done>
</task>

<task type="auto">
  <name>Task 3: Verify version logging in analyzer.pike</name>
  <files>pike-scripts/analyzer.pike</files>
  <action>
Verify that analyzer.pike logs the detected Pike version at startup for debugging.

1. Check if main() in analyzer.pike calls LSP.Compat.pike_version() and logs the result
2. If not already present, add version logging:
   ```pike
   // Log Pike version for debugging
   array(int) version = LSP.Compat.pike_version();
   werror("Pike LSP Analyzer running on Pike %d.%d.%d\n",
          version[0], version[1], version[2]);
   ```

3. Ensure this logging happens after the module path is set up and before processing requests

This matches the CONTEXT.md requirement: "Version detection logged at startup for debugging"
  </action>
  <verify>grep -E "(pike_version|Pike.*running)" /home/smuks/OpenCode/pike-lsp/pike-scripts/analyzer.pike</verify>
  <done>analyzer.pike logs detected Pike version at startup via werror().</done>
</task>

</tasks>

<verification>
After completing all tasks:

1. Verify README.md has Compatibility section after Requirements
2. Verify supported versions table is present
3. Verify Known Issues table exists (even if empty)
4. Verify CONTRIBUTING.md mentions Pike 8.1116 specifically
5. Verify CONTRIBUTING.md has Version Testing subsection
6. Verify analyzer.pike logs Pike version at startup
7. Run analyzer to verify version logging appears in output
</verification>

<success_criteria>
1. README.md has "## Compatibility" section
2. Supported versions table shows 8.1116 as required, latest as best-effort
3. Known Issues table exists for future version-specific issues
4. CONTRIBUTING.md specifies Pike 8.1116 for local development
5. CONTRIBUTING.md has Version Testing subsection
6. analyzer.pike logs Pike version at startup
</success_criteria>

<output>
After completion, create `.planning/phases/05-verification/05-03-SUMMARY.md`
</output>
