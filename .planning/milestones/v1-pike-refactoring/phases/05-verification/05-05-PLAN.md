---
phase: 05-verification
plan: 05
type: execute
wave: 3
depends_on: [05-01, 05-02, 05-03, 05-04]
files_modified: [.planning/phases/05-verification/05-VERIFICATION.md]
autonomous: true
user_setup: []

must_haves:
  truths:
    - "All module loading tests pass on installed Pike version"
    - "GitHub Actions workflow includes Pike version matrix"
    - "README.md documents compatibility and known issues"
    - "All 12 LSP handlers tested for cross-version compatibility"
    - "Version detection logged at startup"
    - "Phase 5 requirements (VER-01/02/03, VER-06, QLT-06) satisfied"
  artifacts:
    - path: ".planning/phases/05-verification/05-VERIFICATION.md"
      provides: "Phase 5 verification report"
      contains: "must_haves"
      contains: "score"
  key_links:
    - from: "05-VERIFICATION.md"
      to: ".planning/REQUIREMENTS.md"
      via: "Requirement coverage verification"
      pattern: "VER-0[1-6]|QLT-06"
---

<objective>
Execute the complete verification test suite and create the phase 5 verification report documenting cross-version compatibility validation.

Purpose: Final phase verification that all testing infrastructure is in place and all pending requirements (VER-01/02/03, VER-06, QLT-06) are satisfied. This phase is about testing infrastructure, not running full CI (that happens when the workflow is pushed to GitHub).
Output: Verification report documenting all phase goals achieved and requirements satisfied.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-verification/05-CONTEXT.md
@.planning/REQUIREMENTS.md

# Prior plan summaries for context
@.planning/phases/05-verification/05-01-SUMMARY.md
@.planning/phases/05-verification/05-02-SUMMARY.md
@.planning/phases/05-verification/05-03-SUMMARY.md
@.planning/phases/05-verification/05-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run complete local test suite</name>
  <files>scripts/run-pike-tests.sh</files>
  <action>
Execute the complete Pike test suite to verify everything works on the installed Pike version.

1. Run the test script:
```bash
./scripts/run-pike-tests.sh
```

2. Verify all tests pass:
   - module-load-tests.pike
   - foundation-tests.pike
   - parser-tests.pike
   - intelligence-tests.pike
   - analysis-tests.pike
   - response-format-tests.pike
   - e2e-foundation-tests.pike
   - cross-version-tests.pike

3. Capture test output for verification report

4. If any tests fail:
   - Investigate the failure
   - Fix the issue (test or code)
   - Re-run until all pass

Note: This runs on the local installed Pike version only. CI will test the full matrix when pushed.
  </action>
  <verify>./scripts/run-pike-tests.sh 2>&1 | tee /tmp/pike-test-run.log</verify>
  <done>All Pike tests pass on installed version. Test output captured for verification report.</done>
</task>

<task type="auto">
  <name>Task 2: Verify CI workflow syntax</name>
  <files>.github/workflows/test.yml</files>
  <action>
Validate the GitHub Actions workflow syntax to ensure it will run correctly when pushed.

1. Use GitHub Actions workflow syntax checker if available, or manually verify:
   - YAML syntax is valid (no indentation errors)
   - Matrix strategy is properly configured
   - Pike installation steps are correctly ordered
   - Test execution steps reference correct files
   - continue-on-error is set for latest version

2. Verify all referenced files exist:
   - scripts/run-pike-tests.sh
   - test/tests/module-load-tests.pike
   - test/tests/cross-version-tests.pike

3. Verify job dependencies:
   - pike-test job is independent (can run parallel with Node.js tests)
   - build-extension depends on both test and pike-test
   - Required version (8.1116) failures block the build
   - Latest version failures don't block due to continue-on-error

4. Document any issues found and fixes applied
  </action>
  <verify>
python3 -c "import yaml; yaml.safe_load(open('/home/smuks/OpenCode/pike-lsp/.github/workflows/test.yml'))" && echo "YAML syntax valid"
  </verify>
  <done>CI workflow YAML syntax is valid. All referenced files exist. Matrix strategy and continue-on-error configured correctly.</done>
</task>

<task type="auto">
  <name>Task 3: Create verification report</name>
  <files>.planning/phases/05-verification/05-VERIFICATION.md</files>
  <action>
Create `.planning/phases/05-verification/05-VERIFICATION.md` with the following structure:

**Frontmatter:**
```yaml
---
phase: 05-verification
verified: [DATE]
status: passed
score: [X]/[Y] must-haves verified
gaps: []
---
```

**Phase Goal:** Validate the refactored codebase runs correctly on all target Pike versions with comprehensive cross-version testing.

**Goal Achievement:**

1. **Observable Truths table:**
   | # | Truth | Status | Evidence |
   |---|-------|--------|----------|
   | 1 | All LSP modules load via master()->resolv() | VERIFIED | module-load-tests.pike passes |
   | 2 | GitHub Actions tests on multiple Pike versions | VERIFIED | test.yml has matrix strategy |
   | 3 | Pike 8.1116 is required to pass | VERIFIED | continue-on-error only for latest |
   | 4 | Latest Pike tested best-effort | VERIFIED | continue-on-error: true for latest |
   | 5 | README documents compatibility | VERIFIED | Compatibility section added |
   | 6 | Version detection logged at startup | VERIFIED | analyzer.pike logs pike_version() |
   | 7 | All 12 handlers cross-version tested | VERIFIED | cross-version-tests.pike passes |

2. **Required Artifacts table:**
   - test/tests/module-load-tests.pike
   - .github/workflows/test.yml (updated)
   - scripts/run-pike-tests.sh
   - README.md (updated)
   - CONTRIBUTING.md (updated)
   - test/tests/cross-version-tests.pike
   - 05-VERIFICATION.md

3. **Requirements Coverage:**
   - VER-01: Code runs on Pike 8.1116 (LOCAL - verified on installed version)
   - VER-02: Code runs on Pike 8.x latest (PENDING - will verify in CI)
   - VER-03: Compat.pmod provides unified API (SATISFIED)
   - VER-06: Cross-version tests verify all handlers (SATISFIED)
   - QLT-06: Module loading tested (SATISFIED)

4. **Version Note:**
   - ROADMAP mentioned 7.6/7.8/8.0.x but CONTEXT.md updated to 8.1116/latest
   - This is correct: older Pike versions not available on Ubuntu 24.04 CI
   - Two-tier support model: 8.1116 required, latest best-effort

5. **CI Status:**
   - Local tests: PASS (all tests pass on installed Pike)
   - CI tests: PENDING (will run when workflow is pushed to GitHub)
   - Note: Full matrix validation requires GitHub Actions execution

6. **Human Verification Required:**
   - None - this phase is about test infrastructure, not visual verification
   - CI matrix will be validated when workflow runs on GitHub

7. **Gaps Summary:**
   - None - all phase goals achieved
  </action>
  <verify>
ls -la /home/smuks/OpenCode/pike-lsp/.planning/phases/05-verification/05-VERIFICATION.md
</verify>
  <done>05-VERIFICATION.md exists with all must-haves documented, requirements coverage table, and CI status notes.</done>
</task>

<task type="auto">
  <name>Task 4: Create phase summary</name>
  <files>.planning/phases/05-verification/05-05-SUMMARY.md</files>
  <action>
Create `.planning/phases/05-verification/05-05-SUMMARY.md` following the established summary format.

Include:
1. Phase metadata (phase number, plan number, subsystem)
2. Dependency graph
3. Tech tracking (tech-stack, patterns, key files, key decisions)
4. Metrics (duration, completion date)
5. Accomplishments (what was built)
6. Test coverage details
7. Task commits
8. Files created/modified
9. Decisions made
10. Deviations from plan
11. Next phase readiness (or project completion note)

This is the final phase, so note:
- All 5 phases complete
- Total project refactoring done
- All v1 requirements satisfied
- Ready for production use
  </action>
  <verify>
ls -la /home/smuks/OpenCode/pike-lsp/.planning/phases/05-verification/05-05-SUMMARY.md
</verify>
  <done>05-05-SUMMARY.md exists with complete phase summary including project completion notes.</done>
</task>

</tasks>

<verification>
After completing all tasks:

1. Verify all Pike tests pass: `./scripts/run-pike-tests.sh`
2. Verify CI workflow YAML is valid
3. Verify 05-VERIFICATION.md exists and documents all must-haves
4. Verify 05-05-SUMMARY.md exists with complete phase summary
5. Verify all phase requirements satisfied (VER-01/02/03, VER-06, QLT-06)
6. Verify README.md has Compatibility section
7. Verify CONTRIBUTING.md has version guidance
</verification>

<success_criteria>
1. All Pike tests pass on installed version
2. CI workflow YAML syntax is valid
3. 05-VERIFICATION.md documents 7/7 must-haves verified
4. 05-05-SUMMARY.md exists
5. All phase requirements marked as satisfied
6. Project marked as complete (all 5 phases done)
</success_criteria>

<output>
After completion, create `.planning/phases/05-verification/05-05-SUMMARY.md`

This is the final plan of the refactoring project. Upon completion, update STATE.md and ROADMAP.md to mark Phase 5 as complete.
</output>
