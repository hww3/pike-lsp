---
phase: 12-request-consolidation
plan: 02
type: execute
wave: 1
depends_on: ["12-01"]
files_modified: [packages/pike-bridge/src/types.ts, packages/pike-bridge/src/bridge.ts, packages/pike-lsp-server/src/services/bridge-manager.ts]
autonomous: true
must_haves:
  truths:
    - "TypeScript AnalyzeRequest and AnalyzeResponse types are defined"
    - "PikeBridge.analyze() method exists"
    - "BridgeManager exposes analyze() pass-through"
  artifacts:
    - path: "packages/pike-bridge/src/types.ts"
      provides: "AnalyzeRequest/AnalyzeResponse types"
      contains: "export interface AnalyzeRequest"
    - path: "packages/pike-bridge/src/bridge.ts"
      provides: "analyze() method"
      exports: ["analyze"]
    - path: "packages/pike-lsp-server/src/services/bridge-manager.ts"
      provides: "analyze() pass-through"
      exports: ["analyze"]
  key_links:
    - from: "PikeBridge.analyze()"
      to: "sendRequest('analyze')"
      via: "JSON-RPC call"
    - from: "BridgeManager.analyze()"
      to: "this.bridge.analyze()"
      via: "pass-through"
---

<objective>
Add TypeScript-side support for the unified analyze request.

Purpose: Provide type-safe access to the new Pike analyze method from TypeScript.
Output: analyze() method on PikeBridge and BridgeManager with proper types.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-request-consolidation/12-CONTEXT.md
@.planning/phases/12-request-consolidation/12-RESEARCH.md
@.planning/phases/12-request-consolidation/12-01-SUMMARY.md
@packages/pike-bridge/src/types.ts
@packages/pike-bridge/src/bridge.ts
@packages/pike-lsp-server/src/services/bridge-manager.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add AnalyzeRequest and AnalyzeResponse types</name>
  <files>packages/pike-bridge/src/types.ts</files>
  <action>
    Add TypeScript types matching the Pike analyze contract:
    1. AnalyzeRequest interface with: code, filename?, include: Array<'parse' | 'introspect' | 'diagnostics' | 'tokenize'>
    2. AnalyzeResponse interface with:
       - result?: { parse?: PikeParseResult, introspect?: IntrospectionResult, diagnostics?: AnalyzeUninitializedResult, tokenize?: { tokens: PikeToken[] } }
       - failures?: { parse?: { message: string; kind: string }, introspect?: { message: string; kind: string }, diagnostics?: { message: string; kind: string }, tokenize?: { message: string; kind: string } }
       - _perf?: { pike_total_ms: number; compilation_ms?: number; tokenization_ms?: number }
    3. Update PikeRequest method union to include 'analyze'

    Use O(1) lookup pattern: failures?.parse is direct access, not iteration.
  </action>
  <verify>TypeScript compiles without errors: cd packages/pike-bridge && pnpm build</verify>
  <done>TypeScript types defined for analyze request/response.</done>
</task>

<task type="auto">
  <name>Task 2: Add PikeBridge.analyze() method</name>
  <files>packages/pike-bridge/src/bridge.ts</files>
  <action>
    Add analyze() method to PikeBridge class:
    - Accepts code: string, filename?: string, include: Array<'parse' | 'introspect' | 'diagnostics' | 'tokenize'>
    - Calls sendRequest<AnalyzeResponse>('analyze', { code, filename, include })
    - Returns Promise<AnalyzeResponse>
    - Include JSDoc documentation with example usage

    Pattern: Follow existing methods like introspect() and parse().
  </action>
  <verify>TypeScript compiles: cd packages/pike-bridge && pnpm build</verify>
  <done>PikeBridge has analyze() method for unified requests.</done>
</task>

<task type="auto">
  <name>Task 3: Add BridgeManager analyze() pass-through</name>
  <files>packages/pike-lsp-server/src/services/bridge-manager.ts</files>
  <action>
    Add analyze() pass-through method to BridgeManager:
    - Delegates to this.bridge.analyze()
    - Handles null bridge case (throw or return error)
    - Follows the same pattern as parse(), introspect(), etc.
  </action>
  <verify>TypeScript compiles: cd packages/pike-lsp-server && pnpm build</verify>
  <done>BridgeManager exposes analyze() method to LSP server features.</done>
</task>

</tasks>

<verification>
1. TypeScript compilation succeeds for both packages
2. PikeBridge.analyze() method signature matches types
3. BridgeManager.analyze() correctly delegates
</verification>

<success_criteria>
TypeScript code can call bridge.analyze() with type safety for all include options.
</success_criteria>

<output>
After completion, create `.planning/phases/12-request-consolidation/12-02-SUMMARY.md`
</output>
